{% extends 'base.html' %}

{% block title %}Owner Dashboard - Find Home{% endblock %}

{% block content %}
<section class="py-4">
    <div class="container">
        <div class="row">
            <div class="col-12 mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2>Owner Dashboard</h2>
                        <p class="text-muted">Welcome, {{ user.get_full_name|default:user.username }}!</p>
                    </div>
                    <a href="{% url 'create_listing' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add New Listing
                    </a>
                </div>
            </div>
        </div>
        
        <!-- New Interests Notifications -->
        {% if new_interests %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-warning">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">
                                <i class="fas fa-bell"></i> New Interest Notifications ({{ new_interests.count }})
                            </h5>
                        </div>
                        <div class="card-body">
                            {% for interest in new_interests %}
                                <div class="interest-notification">
                                    <strong>{{ interest.renter.get_full_name|default:interest.renter.username }}</strong> 
                                    is interested in <strong>{{ interest.listing.title }}</strong>
                                    <small class="text-muted d-block">{{ interest.created_at|date:"M d, Y H:i" }}</small>
                                    <div class="mt-2">
                                        <a href="{% url 'chat_view' interest.listing.pk %}?renter_id={{ interest.renter.id }}" class="btn btn-sm btn-primary">
                                            <i class="fas fa-comments"></i> Chat
                                        </a>
                                        <a href="{% url 'listing_detail' interest.listing.pk %}" class="btn btn-sm btn-outline-primary">
                                            View Listing
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        
        <!-- My Listings -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-building"></i> My Listings ({{ listings.count }})
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if listings %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Property</th>
                                            <th>Type</th>
                                            <th>Rent</th>
                                            <th>Status</th>
                                            <th>Posted</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for listing in listings %}
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        {% if listing.images.first %}
                                                            <img src="{{ listing.images.first.image.url }}" class="rounded me-2" style="width: 40px; height: 40px; object-fit: cover;" alt="Property">
                                                        {% else %}
                                                            <div class="bg-light rounded me-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                                <i class="fas fa-home text-muted"></i>
                                                            </div>
                                                        {% endif %}
                                                        <div>
                                                            <h6 class="mb-0">{{ listing.title }}</h6>
                                                            <small class="text-muted">{{ listing.area }}</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>{{ listing.get_house_type_display }}</td>
                                                <td>à§³{{ listing.rent }}</td>
                                                <td>
                                                    {% if listing.status == 'available' %}
                                                        <span class="badge bg-success">Available</span>
                                                    {% else %}
                                                        <span class="badge bg-warning">Booked</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ listing.created_at|date:"M d, Y" }}</td>
                                                <td>
                                                    <div class="btn-group" role="group">
                                                        <a href="{% url 'listing_detail' listing.pk %}" class="btn btn-sm btn-outline-primary">View</a>
                                                        <div class="btn-group" role="group">
                                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                                                Status
                                                            </button>
                                                            <ul class="dropdown-menu">
                                                                <li>
                                                                    <form method="post" action="{% url 'update_listing_status' listing.pk %}">
                                                                        {% csrf_token %}
                                                                        <input type="hidden" name="status" value="available">
                                                                        <button type="submit" class="dropdown-item">Mark Available</button>
                                                                    </form>
                                                                </li>
                                                                <li>
                                                                    <form method="post" action="{% url 'update_listing_status' listing.pk %}">
                                                                        {% csrf_token %}
                                                                        <input type="hidden" name="status" value="booked">
                                                                        <button type="submit" class="dropdown-item">Mark Booked</button>
                                                                    </form>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-building fa-3x text-muted mb-3"></i>
                                <h5>No listings yet</h5>
                                <p class="text-muted">Create your first property listing to start receiving inquiries.</p>
                                <a href="{% url 'create_listing' %}" class="btn btn-primary">Create First Listing</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}